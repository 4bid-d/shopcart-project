<head>
  <title>{{title}}</title>
  <link rel="stylesheet" href="\stylesheets\style.css">
</head>


<body id="body">



  <section class="container mt-3 pt-5" id="home">
    <div class="raw">
      <h1 class="mt-3">Cart</h1>
      <p id="deleteDisplay"></p>
    </div>
    <hr>

    <div class="row" id="div1">

      <section>
      {{#each productArray}}
        <div id="{{this._id}}" class="row mb-4 d-flex justify-content-between align-items-center">
          <div class="col-md-2 col-lg-2 col-xl-2">
            <img style="height: 150px;width:300px" src="/images/{{this.imgId}}.jpg " class="img-fluid rounded-3"
              alt="Cotton T-shirt">
          </div>
          <div class="col-md-3 col-lg-3 col-xl-3">
            <h6 class="text-muted">{{this.productName}}</h6>
            <h6 class="text-black mb-0">Description :{{this.desc}}</h6>
          </div>
          <div class="col-md-3 col-lg-3 col-xl-2 d-flex">
            <button id="minus" class="btn btn-link px-2"
              onclick=productDecrement("{{this._id}}","displayQuantity{{this._id}}")>
              <i class="fa fa-minus"></i></button>

            <p id="displayQuantity{{this._id}}" class="m2">{{this.quantity}}</p>

            <button id="plus" class="btn btn-link px-2"
              onclick=productIncrement("{{this._id}}","displayQuantity{{this._id}}")>
              <i class="fa fa-plus"></i></button>
          </div>
          <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
            <h6 class="mb-0">Rs: {{this.Price}}</h6>
          </div>
          <div class="col-md-1 col-lg-1 col-xl-1 text-end">
            <button onclick=cartDelete("{{this._id}}") class="text-muted"><i class="fa fa-times "></i></button>
          </div>
        </div>
      {{/each}}
      <hr>
          <h3 style="float:right;">total:{{Total}}</h3>
      </section>

    </div>



    <a href="/user" class="btn btn-success" style="float:right ;">Back</a>


  </section>


  <script>

    //this.parentNode.querySelector('input[type=number]').stepUp()  this.parentNode.querySelector('input[type=number]').stepDown()

    const plusIcon = document.getElementById('plus')
    const minusIcon = document.getElementById('minus')
    const allDisplay = document.querySelectorAll('.m2')

    async function productIncrement(id, specifiedDisplay) {
      const display = document.getElementById(specifiedDisplay)
      const quantity = display.textContent
      let url = `http://localhost:3000/user/quantityIecrement/${id}/${quantity}`;
      let data = await fetch(url, { method: 'GET' })
      let response = await data.json()
      display.innerHTML = response.updatedValue

    }
  
    async function productDecrement(id, specifiedDisplay) {
      const display = document.getElementById(specifiedDisplay)
      if(display.innerText >= 2){
          const quantity = display.textContent
          let url = `http://localhost:3000/user/quantityDecrement/${id}/${quantity}`;
          let data = await fetch(url, { method: 'GET' })
          let response = await data.json()
          display.innerHTML = response.updatedValue

      }else{
         
      }
     

    }
    async function cartDelete(id) {
      const displayStatus = document.getElementById('deleteDisplay')
      if (confirm("Are sure to delete this item ?")){
        let url = `http://localhost:3000/user/deleteCart/${id}`;
        let data = await fetch(url, { method: 'GET' })
        let response = await data.json()
        if (response) {
          alert("deletion success Full")
          document.getElementById(id).remove()
        }else if(response.redirect){
          window.location.href = response.redirect
        }else {
          displayStatus.style.color = "red"
          displayStatus.innerHTML = "deletion failed"
        }
      }

    }

  </script>



</body>